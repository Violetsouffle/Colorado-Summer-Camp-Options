<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Colorado Summer Camp Options</title>
  <meta name="description" content="Find the perfect summer camp in Colorado. Search, compare, and save your favorites.">
  <meta name="robots" content="noindex, nofollow, noarchive, noimageindex">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    :root { 
      --cream: #fff8e9;
      --cream-dark: #f0e6d3;
      --green: #91a858;
      --green-dark: #7a9148;
      --green-light: #a8bc6f;
      --bark: #5c4a3a;
      --bark-light: #8b7355;
      --sunset: #e8985e;
      --sunset-light: #f5d4b8;
      --sky: #7fb5c7;
      --verified: #4caf50;
      
      --text: #3e3632;
      --text-light: #7a7168;
      --border: #e0d6c8;
      --shadow: 0 2px 12px rgba(62, 54, 50, 0.08);
      --shadow-hover: 0 6px 24px rgba(62, 54, 50, 0.12);
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Nunito', sans-serif;
      background: var(--cream);
      color: var(--text);
      line-height: 1.6;
    }
    
    /* ============ HERO ============ */
    .hero {
      background: linear-gradient(135deg, var(--green) 0%, var(--green-dark) 100%);
      padding: 40px 24px;
      text-align: center;
      color: white;
    }
    
    .hero h1 {
      font-size: 36px;
      font-weight: 800;
      margin-bottom: 8px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      color: #fffaed;
    }
    
    .hero .tagline {
      font-size: 18px;
      opacity: 0.9;
      margin-bottom: 20px;
    }
    
    .stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
    }
    
    .stat {
      text-align: center;
    }
    
    .stat-num {
      display: block;
      font-size: 32px;
      font-weight: 800;
    }
    
    .stat-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      opacity: 0.8;
    }
    
    /* ============ CONTAINER ============ */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }
    
    /* ============ SEARCH SECTION ============ */
    .search-section {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    
    .search-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .search-input-group label {
      display: block;
      font-size: 12px;
      font-weight: 700;
      color: var(--text-light);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }
    
    .search-input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 15px;
      font-family: 'Nunito', sans-serif;
      background: var(--cream);
      transition: all 0.2s;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--green);
      background: white;
    }
    
    /* ============ FILTERS ============ */
    .filters-section {
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    
    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .filter-group h3 {
      font-size: 13px;
      font-weight: 700;
      color: var(--bark);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 2px solid var(--cream-dark);
    }
    
    /* Pills */
    .pills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    
    .pill {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      border: 2px solid var(--border);
      background: var(--cream);
      color: var(--text);
      user-select: none;
    }
    
    .pill:hover {
      border-color: var(--green-light);
      background: white;
    }
    
    .pill.active {
      background: var(--green);
      color: white;
      border-color: var(--green);
    }
    
    /* Week pills - scrollable */
    .weeks-container {
      display: flex;
      gap: 6px;
      overflow-x: auto;
      padding-bottom: 6px;
    }
    
    .week-pill {
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      border: 2px solid var(--border);
      background: var(--cream);
      color: var(--text);
      white-space: nowrap;
      flex-shrink: 0;
      text-align: center;
    }
    
    .week-pill:hover {
      border-color: var(--green-light);
    }
    
    .week-pill.active {
      background: var(--sunset);
      color: white;
      border-color: var(--sunset);
    }
    
    .week-pill .week-num {
      display: block;
      font-weight: 700;
      font-size: 12px;
    }
    
    .week-pill .week-dates {
      font-size: 10px;
      opacity: 0.8;
    }
    
    /* Age inputs */
    .age-inputs {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .age-input {
      width: 70px;
      padding: 8px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Nunito', sans-serif;
      text-align: center;
      background: var(--cream);
    }
    
    .age-input:focus {
      outline: none;
      border-color: var(--green);
      background: white;
    }
    
    .age-separator {
      font-weight: 600;
      color: var(--text-light);
      font-size: 13px;
    }
    
    /* ============ ACTION BAR ============ */
    .action-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 24px;
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid var(--border);
      font-family: 'Nunito', sans-serif;
      background: white;
      color: var(--text);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    
    .btn-primary {
      background: var(--green);
      color: white;
      border-color: var(--green);
    }
    
    .btn-primary:hover {
      background: var(--green-dark);
    }
    
    .btn-secondary {
      background: var(--sunset-light);
      color: var(--bark);
      border-color: var(--sunset);
    }
    
    .fb-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      background: #1877f2;
      color: white;
      text-decoration: none;
      border-radius: 10px;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .fb-link:hover {
      background: #0d65d9;
      transform: translateY(-2px);
    }
    
    /* ============ RESULTS ============ */
    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    .results-info {
      font-size: 18px;
      font-weight: 700;
      color: var(--bark);
    }
    
    .results-meta {
      font-size: 13px;
      color: var(--text-light);
    }
    
    /* ============ CARDS ============ */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }
    
    .camp-card {
      background: white;
      border-radius: 16px;
      overflow: hidden;
      border: 2px solid var(--border);
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .camp-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
      border-color: var(--green);
    }
    
    .card-header {
      background: linear-gradient(135deg, var(--cream) 0%, var(--sunset-light) 100%);
      padding: 16px;
      position: relative;
    }
    
    .card-actions {
      position: absolute;
      top: 12px;
      right: 12px;
      display: flex;
      gap: 8px;
    }
    
    .card-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: white;
      border: 2px solid var(--border);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: all 0.15s;
    }
    
    .card-btn:hover {
      transform: scale(1.1);
    }
    
    .card-btn.active {
      background: var(--green);
      border-color: var(--green);
      color: white;
    }
    
    .verified-badge {
      position: absolute;
      top: 12px;
      left: 12px;
      background: var(--verified);
      color: white;
      padding: 4px 10px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 700;
    }
    
    .card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--bark);
      margin: 0 80px 6px 0;
      line-height: 1.3;
    }
    
    .card-location {
      font-size: 13px;
      color: var(--text-light);
    }
    
    .card-body {
      padding: 16px;
    }
    
    .camp-description {
      font-size: 13px;
      color: var(--text);
      margin-bottom: 12px;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .info-item {
      font-size: 12px;
      color: var(--text-light);
    }
    
    .info-item strong {
      color: var(--text);
      display: block;
    }
    
    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    
    .tag {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
    }
    
    .tag.day { background: var(--cream-dark); color: var(--bark); }
    .tag.overnight { background: #e8f5e9; color: var(--green-dark); }
    .tag.aftercare { background: var(--sunset-light); color: var(--bark); }
    .tag.scholarship { background: #e3f2fd; color: #1565c0; }
    .tag.cit { background: #f3e5f5; color: #7b1fa2; }
    .tag.school-day { background: #fff3e0; color: #e65100; }
    
    .card-footer {
      padding: 12px 16px;
      background: var(--cream);
      border-top: 1px solid var(--border);
    }
    
    .reg-link {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 8px;
      background: var(--green);
      color: white;
      text-decoration: none;
      font-size: 13px;
      font-weight: 700;
      transition: all 0.2s;
    }
    
    .reg-link:hover {
      background: var(--green-dark);
    }
    
    .reg-link.disabled {
      background: var(--border);
      color: var(--text-light);
      cursor: not-allowed;
    }
    
    /* ============ MODAL ============ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(62, 54, 50, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-y: auto;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 16px;
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    
    .modal-header {
      padding: 24px;
      background: linear-gradient(135deg, var(--cream) 0%, var(--sunset-light) 100%);
      border-bottom: 2px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: 800;
      color: var(--bark);
      margin-right: 50px;
    }
    
    .modal-subtitle {
      font-size: 14px;
      color: var(--text-light);
      margin-top: 4px;
    }
    
    /* Floating close button */
    .close-btn {
      position: fixed;
      top: 50%;
      right: calc(50% - 420px);
      transform: translateY(-50%);
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: var(--green);
      color: white;
      border: 3px solid white;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      z-index: 1001;
      transition: all 0.2s;
    }
    
    .close-btn:hover {
      background: var(--green-dark);
      transform: translateY(-50%) scale(1.1);
    }
    
    .modal-body {
      padding: 24px;
    }
    
    .detail-section {
      margin-bottom: 24px;
    }
    
    .detail-section h3 {
      font-size: 16px;
      color: var(--bark);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--cream-dark);
    }
    
    .detail-grid {
      display: grid;
      grid-template-columns: 150px 1fr;
      gap: 12px;
    }
    
    .detail-label {
      font-weight: 700;
      color: var(--text-light);
      font-size: 13px;
    }
    
    .detail-value {
      font-size: 14px;
      color: var(--text);
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 24px;
    }
    
    /* ============ SHARE MODAL ============ */
    #shareModal .modal-body {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    #shareMessage {
      padding: 12px;
      border-radius: 8px;
      background: var(--cream);
      color: var(--green-dark);
      font-weight: 600;
      text-align: center;
    }
    
    /* ============ PAGINATION ============ */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      margin: 24px 0;
    }
    
    .pagination button {
      padding: 10px 20px;
      border-radius: 8px;
      border: 2px solid var(--border);
      background: white;
      color: var(--text);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
      transition: all 0.2s;
    }
    
    .pagination button:hover:not(:disabled) {
      background: var(--green);
      color: white;
      border-color: var(--green);
    }
    
    .pagination button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .pagination span {
      font-size: 14px;
      color: var(--text-light);
    }
    
    /* ============ EMPTY STATE ============ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-light);
    }
    
    .empty-state h3 {
      font-size: 22px;
      color: var(--bark);
      margin-bottom: 8px;
    }
    
    /* ============ FOOTER ============ */
    footer {
      background: var(--cream-dark);
      border-top: 2px solid var(--border);
      padding: 32px 24px;
      margin-top: 48px;
    }
    
    .footer-content {
      max-width: 1400px;
      margin: 0 auto;
      text-align: center;
    }
    
    .copyright-notice {
      background: white;
      border: 2px solid var(--green);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .copyright-notice h3 {
      color: var(--bark);
      font-size: 16px;
      margin-bottom: 8px;
    }
    
    .copyright-notice p {
      font-size: 13px;
      color: var(--text);
      line-height: 1.6;
    }
    
    .footer-text {
      font-size: 12px;
      color: var(--text-light);
    }
    
    /* ============ RESPONSIVE ============ */
    @media (max-width: 900px) {
      .close-btn {
        right: 20px;
        top: 20px;
        transform: none;
        position: absolute;
      }
    }
    
    @media (max-width: 768px) {
      .hero h1 { font-size: 28px; }
      .search-grid { grid-template-columns: 1fr; }
      .filters-grid { grid-template-columns: 1fr 1fr; }
      .cards-grid { grid-template-columns: 1fr; }
      .info-grid { grid-template-columns: 1fr; }
      .detail-grid { grid-template-columns: 1fr; }
    }
    
    @media (max-width: 480px) {
      .filters-grid { grid-template-columns: 1fr; }
      .action-bar { flex-direction: column; align-items: stretch; }
      .btn-group { flex-direction: column; }
    }
  </style>
</head>
<body>

  <div class="hero">
    <h1>Colorado Summer Camp Options</h1>
    <p class="tagline">Find, compare, and save your perfect camps</p>
    <div class="stats">
      <div class="stat">
        <span class="stat-num" id="totalCamps">---</span>
        <span class="stat-label">Total Camps</span>
      </div>
      <div class="stat">
        <span class="stat-num" id="favCount">0</span>
        <span class="stat-label">Favorites</span>
      </div>
      <div class="stat">
        <span class="stat-num" id="resultsCount">---</span>
        <span class="stat-label">Showing</span>
      </div>
    </div>
  </div>

  <div class="container">
    
    <!-- Search Section -->
    <div class="search-section">
      <div class="search-grid">
        <div class="search-input-group">
          <label>Search Camps</label>
          <input type="text" id="searchInput" class="search-input" placeholder="Search by camp name or activity type..." autocomplete="off">
        </div>
        <div class="search-input-group">
          <label>Search by Location</label>
          <input type="text" id="locationInput" class="search-input" placeholder="City name (Boulder, Denver...)" autocomplete="off">
        </div>
      </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
      <div class="filters-grid">
        
        <!-- Scheduling - Weeks, Duration, Setting combined -->
        <div class="filter-group" style="grid-column: span 2;">
          <h3>Scheduling</h3>
          <div class="weeks-container" id="weekFilters" style="margin-bottom: 12px;"></div>
          <div class="pills">
            <span class="pill" data-filter="duration" data-value="fullday">Full Day</span>
            <span class="pill" data-filter="duration" data-value="halfday">Half Day</span>
            <span class="pill" data-filter="duration" data-value="overnight">Overnight</span>
            <span class="pill" data-filter="setting" data-value="indoor">Indoor</span>
            <span class="pill" data-filter="setting" data-value="outdoor">Outdoor</span>
            <span class="pill" data-filter="setting" data-value="both">Both</span>
          </div>
        </div>
        
        <!-- Details - all the Y/N features -->
        <div class="filter-group">
          <h3>Details</h3>
          <div class="pills">
            <span class="pill" data-filter="features" data-value="aftercare">Aftercare</span>
            <span class="pill" data-filter="features" data-value="scholarship">Scholarships</span>
            <span class="pill" data-filter="features" data-value="cit">CIT Program</span>
            <span class="pill" data-filter="features" data-value="verified">Verified by Camp</span>
            <span class="pill" data-filter="features" data-value="licensed">Licensed</span>
            <span class="pill" data-filter="features" data-value="schoolday">School Day Off</span>
          </div>
        </div>
        
        <!-- Age Range -->
        <div class="filter-group">
          <h3>Age Range</h3>
          <div class="age-inputs">
            <input type="number" id="ageMin" class="age-input" placeholder="Min" min="3" max="18">
            <span class="age-separator">to</span>
            <input type="number" id="ageMax" class="age-input" placeholder="Max" min="3" max="18">
          </div>
        </div>
        
      </div>
    </div>

    <!-- Action Bar -->
    <div class="action-bar">
      <div class="btn-group">
        <button class="btn" id="clearFilters">Reset Filters</button>
        <button class="btn btn-secondary" id="showFavorites">My Favorites (<span id="favBtnCount">0</span>)</button>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" id="shareBtn">Share List</button>
        <a href="https://www.facebook.com/share/g/17xpWxA8Z9/" target="_blank" class="fb-link">Join Our Facebook Group</a>
      </div>
    </div>

    <!-- Results -->
    <div class="results-header">
      <div class="results-info" id="resultsText">Loading camps...</div>
      <div class="results-meta">Last updated: <span id="lastUpdated">---</span></div>
    </div>

    <div id="cardsView" class="cards-grid"></div>
    
    <div class="pagination" id="pagination" style="display: none;">
      <button id="prevPage">‚Üê Previous</button>
      <span id="pageInfo">Page 1 of 1</span>
      <button id="nextPage">Next ‚Üí</button>
    </div>
  </div>

  <footer>
    <div class="footer-content">
      <div class="copyright-notice">
        <h3>‚ö†Ô∏è Copyright & Usage Notice</h3>
        <p>This Colorado Summer Camp resource is provided strictly for <strong>personal, non-commercial use</strong> by parents and caregivers. Any scraping, redistribution, or commercial use of this data is <strong>strictly prohibited</strong> without express written consent.</p>
      </div>
      <p class="footer-text">¬© 2026 Colorado Summer Camp Options. All rights reserved. Data is subject to change.</p>
    </div>
  </footer>

  <!-- Camp Details Modal -->
  <div class="modal" id="campModal">
    <div class="modal-content">
      <div class="modal-header">
        <div id="modalTitleSection"></div>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
    <button class="close-btn" onclick="closeCampModal()">√ó</button>
  </div>

  <!-- Share Modal -->
  <div class="modal" id="shareModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Share Your List</div>
      </div>
      <div class="modal-body">
        <button class="btn btn-primary" onclick="emailList()" style="width: 100%;">üìß Email myself this list</button>
        <button class="btn btn-primary" onclick="copyShareLink()" style="width: 100%;">üîó Copy shareable link</button>
        <div id="shareMessage" style="display: none;"></div>
      </div>
    </div>
    <button class="close-btn" onclick="closeShareModal()">√ó</button>
  </div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbwxRiD40cOmWXRyW0EJXRKrtEU_cfqEIrQ8kV9OYye6P-2j7ZRz9eb0tmy-v7ytoifw/exec';
const RESULTS_PER_PAGE = 50;

// Summer weeks - easy to update annually
const SUMMER_WEEKS = [
  { label: 'Week 1', dates: 'May 25-29', start: new Date('2026-05-25'), end: new Date('2026-05-29'), note: 'Memorial Day' },
  { label: 'Week 2', dates: 'Jun 1-5', start: new Date('2026-06-01'), end: new Date('2026-06-05') },
  { label: 'Week 3', dates: 'Jun 8-12', start: new Date('2026-06-08'), end: new Date('2026-06-12') },
  { label: 'Week 4', dates: 'Jun 15-19', start: new Date('2026-06-15'), end: new Date('2026-06-19') },
  { label: 'Week 5', dates: 'Jun 22-26', start: new Date('2026-06-22'), end: new Date('2026-06-26') },
  { label: 'Week 6', dates: 'Jun 29-Jul 3', start: new Date('2026-06-29'), end: new Date('2026-07-03'), note: 'July 4th' },
  { label: 'Week 7', dates: 'Jul 6-10', start: new Date('2026-07-06'), end: new Date('2026-07-10') },
  { label: 'Week 8', dates: 'Jul 13-17', start: new Date('2026-07-13'), end: new Date('2026-07-17') },
  { label: 'Week 9', dates: 'Jul 20-24', start: new Date('2026-07-20'), end: new Date('2026-07-24') },
  { label: 'Week 10', dates: 'Jul 27-31', start: new Date('2026-07-27'), end: new Date('2026-07-31') },
  { label: 'Week 11', dates: 'Aug 3-7', start: new Date('2026-08-03'), end: new Date('2026-08-07') },
  { label: 'Week 12', dates: 'Aug 10-14', start: new Date('2026-08-10'), end: new Date('2026-08-14') },
  { label: 'Week 13', dates: 'Aug 17-21', start: new Date('2026-08-17'), end: new Date('2026-08-21') }
];

let allCamps = [];
let filteredCamps = [];
let allLocations = new Set();
let currentPage = 1;
let favorites = new Set(JSON.parse(localStorage.getItem('campFavorites') || '[]'));
let isInitialLoad = true;

let filters = {
  search: '',
  location: '',
  weeks: new Set(),
  duration: new Set(),
  setting: new Set(),
  features: new Set(),
  ageMin: null,
  ageMax: null,
  favoritesOnly: false
};

// ============ UTILITY FUNCTIONS ============

// Check if value means "yes" (Y, Yes, yes, YES, etc.)
function isYes(val) {
  return val && (val.toString().toUpperCase() === 'Y' || val.toString().toUpperCase() === 'YES');
}

// Normalize text for fuzzy matching - removes punctuation, extra spaces, lowercases
function normalize(str) {
  return (str || '')
    .toLowerCase()
    .replace(/[''`",.!?-]/g, '')  // Remove punctuation
    .replace(/\s+/g, ' ')          // Collapse whitespace
    .trim();
}

// Check if search term matches text (fuzzy)
function fuzzyMatch(searchTerm, text) {
  const normalizedSearch = normalize(searchTerm);
  const normalizedText = normalize(text);
  
  // Direct include
  if (normalizedText.includes(normalizedSearch)) return true;
  
  // Check each word in search against text
  const searchWords = normalizedSearch.split(' ');
  return searchWords.every(word => normalizedText.includes(word));
}

// Escape HTML
function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str || '';
  return div.innerHTML;
}

// Format date range
function formatDateRange(start, end) {
  if (!start || !end) return 'TBD';
  try {
    const s = new Date(start).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    const e = new Date(end).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    return `${s} - ${e}`;
  } catch (e) {
    return 'TBD';
  }
}

// Ensure URL has protocol
function ensureUrl(url) {
  if (!url) return '';
  url = url.trim();
  if (url && !url.startsWith('http://') && !url.startsWith('https://')) {
    return 'https://' + url;
  }
  return url;
}

// Shuffle array (Fisher-Yates)
function shuffleArray(array) {
  const arr = [...array];
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// ============ LOAD DATA ============

async function loadCamps() {
  try {
    const response = await fetch(API_URL);
    const data = await response.json();
    
    if (!data.success) throw new Error(data.message);
    
    allCamps = data.camps;
    
    // Extract all unique locations
    allCamps.forEach(camp => {
      if (camp.location) {
        allLocations.add(camp.location.trim());
      }
    });
    
    document.getElementById('totalCamps').textContent = allCamps.length.toLocaleString();
    document.getElementById('lastUpdated').textContent = new Date(data.lastUpdated).toLocaleDateString();
    
    setupWeekFilters();
    setupEventListeners();
    applyFilters();
    
  } catch (error) {
    document.getElementById('cardsView').innerHTML = `
      <div class="empty-state">
        <h3>Unable to load camps</h3>
        <p>${error.message}</p>
        <button class="btn btn-primary" onclick="location.reload()">Try Again</button>
      </div>
    `;
  }
}

// ============ SETUP ============

function setupWeekFilters() {
  const container = document.getElementById('weekFilters');
  container.innerHTML = SUMMER_WEEKS.map((week, i) => `
    <div class="week-pill" data-week="${i}">
      <span class="week-num">${week.label}</span>
      <span class="week-dates">${week.dates}</span>
    </div>
  `).join('');
  
  // Add click handlers
  container.querySelectorAll('.week-pill').forEach(pill => {
    pill.addEventListener('click', () => {
      const weekIndex = parseInt(pill.dataset.week);
      pill.classList.toggle('active');
      if (filters.weeks.has(weekIndex)) {
        filters.weeks.delete(weekIndex);
      } else {
        filters.weeks.add(weekIndex);
      }
      applyFilters();
    });
  });
}

function setupEventListeners() {
  // Search inputs
  document.getElementById('searchInput').addEventListener('input', (e) => {
    filters.search = e.target.value;
    isInitialLoad = false;
    applyFilters();
  });
  
  document.getElementById('locationInput').addEventListener('input', (e) => {
    filters.location = e.target.value;
    isInitialLoad = false;
    applyFilters();
  });
  
  // Age inputs
  document.getElementById('ageMin').addEventListener('input', (e) => {
    filters.ageMin = e.target.value ? parseInt(e.target.value) : null;
    isInitialLoad = false;
    applyFilters();
  });
  
  document.getElementById('ageMax').addEventListener('input', (e) => {
    filters.ageMax = e.target.value ? parseInt(e.target.value) : null;
    isInitialLoad = false;
    applyFilters();
  });
  
  // Pill filters
  document.querySelectorAll('.pill[data-filter]').forEach(pill => {
    pill.addEventListener('click', () => {
      const filterType = pill.dataset.filter;
      const value = pill.dataset.value;
      
      pill.classList.toggle('active');
      
      if (filterType === 'duration') {
        if (filters.duration.has(value)) {
          filters.duration.delete(value);
        } else {
          filters.duration.add(value);
        }
      } else if (filterType === 'setting') {
        if (filters.setting.has(value)) {
          filters.setting.delete(value);
        } else {
          filters.setting.add(value);
        }
      } else if (filterType === 'features') {
        if (filters.features.has(value)) {
          filters.features.delete(value);
        } else {
          filters.features.add(value);
        }
      }
      
      isInitialLoad = false;
      applyFilters();
    });
  });
  
  // Buttons
  document.getElementById('clearFilters').addEventListener('click', clearAllFilters);
  document.getElementById('showFavorites').addEventListener('click', toggleFavoritesView);
  document.getElementById('shareBtn').addEventListener('click', () => {
    document.getElementById('shareModal').classList.add('active');
  });
  
  // Pagination
  document.getElementById('prevPage').addEventListener('click', () => {
    if (currentPage > 1) {
      currentPage--;
      renderCards();
      renderPagination();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });
  
  document.getElementById('nextPage').addEventListener('click', () => {
    const totalPages = Math.ceil(filteredCamps.length / RESULTS_PER_PAGE);
    if (currentPage < totalPages) {
      currentPage++;
      renderCards();
      renderPagination();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });
}

// ============ FILTERING ============

function applyFilters() {
  // Check if any filters are active
  const hasActiveFilters = filters.search || filters.location || 
    filters.weeks.size > 0 || filters.duration.size > 0 || 
    filters.setting.size > 0 || filters.features.size > 0 || 
    filters.ageMin || filters.ageMax || filters.favoritesOnly;
  
  // Initial load with no filters - show random sample
  if (isInitialLoad && !hasActiveFilters) {
    const sampleSize = Math.floor(Math.random() * 8) + 5;
    filteredCamps = shuffleArray(allCamps).slice(0, sampleSize);
    currentPage = 1;
    updateStats();
    renderCards();
    renderPagination();
    document.getElementById('resultsText').textContent = `Showing ${sampleSize} featured camps`;
    return;
  }
  
  // Score and filter camps
  let scoredCamps = allCamps.map(camp => {
    let score = 0;
    let passes = true;
    
    // === SEARCH (fuzzy matching, prioritize name) ===
    if (filters.search) {
      const searchTerm = filters.search;
      const nameMatch = fuzzyMatch(searchTerm, camp.campName);
      const descMatch = fuzzyMatch(searchTerm, camp.campDescription);
      const locationMatch = fuzzyMatch(searchTerm, camp.location);
      
      if (nameMatch) {
        score += 100; // High priority for name matches
        // Extra points if name starts with search term
        if (normalize(camp.campName).startsWith(normalize(searchTerm))) {
          score += 50;
        }
      } else if (locationMatch) {
        score += 30;
      } else if (descMatch) {
        score += 10;
      } else {
        passes = false;
      }
    }
    
    // === LOCATION FILTER (separate input, strict match) ===
    if (filters.location) {
      if (!fuzzyMatch(filters.location, camp.location)) {
        passes = false;
      } else {
        score += 20;
      }
    }
    
    // === WEEKS ===
    if (filters.weeks.size > 0) {
      let matchesAnyWeek = false;
      if (camp.startDate2026 && camp.endDate2026) {
        try {
          const campStart = new Date(camp.startDate2026);
          const campEnd = new Date(camp.endDate2026);
          filters.weeks.forEach(weekIndex => {
            const week = SUMMER_WEEKS[weekIndex];
            if (campStart <= week.end && campEnd >= week.start) {
              matchesAnyWeek = true;
            }
          });
        } catch (e) {}
      }
      if (!matchesAnyWeek) passes = false;
    }
    
    // === AGE RANGE ===
    if (filters.ageMin) {
      const campMin = parseInt(camp.ageMin) || 0;
      const campMax = parseInt(camp.ageMax) || 99;
      if (campMax < filters.ageMin) passes = false;
    }
    if (filters.ageMax) {
      const campMin = parseInt(camp.ageMin) || 0;
      if (campMin > filters.ageMax) passes = false;
    }
    
    // === DURATION ===
    if (filters.duration.size > 0) {
      const duration = (camp.duration || '').toLowerCase();
      let matches = false;
      if (filters.duration.has('overnight') && (duration.includes('overnight') || duration.includes('sleepaway'))) matches = true;
      if (filters.duration.has('fullday') && duration.includes('full')) matches = true;
      if (filters.duration.has('halfday') && duration.includes('half')) matches = true;
      if (!matches) passes = false;
    }
    
    // === SETTING ===
    if (filters.setting.size > 0) {
      const setting = (camp.indoorOutdoor || '').toLowerCase();
      let matches = false;
      if (filters.setting.has('indoor') && setting.includes('indoor')) matches = true;
      if (filters.setting.has('outdoor') && setting.includes('outdoor')) matches = true;
      if (filters.setting.has('both') && setting.includes('both')) matches = true;
      if (!matches) passes = false;
    }
    
    // === FEATURES ===
    if (filters.features.has('aftercare') && !isYes(camp.aftercareAvailable)) passes = false;
    if (filters.features.has('scholarship') && !isYes(camp.scholarshipsOffered)) passes = false;
    if (filters.features.has('cit') && !isYes(camp.citProgram)) passes = false;
    if (filters.features.has('schoolday') && !isYes(camp.schoolDayOffCamps)) passes = false;
    if (filters.features.has('verified') && !isYes(camp.verified)) passes = false;
    if (filters.features.has('licensed') && !isYes(camp.licensed)) passes = false;
    
    // === FAVORITES ===
    if (filters.favoritesOnly && !favorites.has(camp.campName)) passes = false;
    
    return { camp, score, passes };
  });
  
  // Filter and sort
  filteredCamps = scoredCamps
    .filter(item => item.passes)
    .sort((a, b) => {
      // Sort by score first (best matches)
      if (b.score !== a.score) return b.score - a.score;
      // Then randomize within same score
      return Math.random() - 0.5;
    })
    .map(item => item.camp);
  
  currentPage = 1;
  updateStats();
  renderCards();
  renderPagination();
}

function updateStats() {
  document.getElementById('resultsCount').textContent = filteredCamps.length.toLocaleString();
  document.getElementById('resultsText').textContent = 
    filters.favoritesOnly ? 
    `${filteredCamps.length} favorite camp${filteredCamps.length !== 1 ? 's' : ''}` :
    `${filteredCamps.length} camp${filteredCamps.length !== 1 ? 's' : ''} found`;
}

// ============ RENDERING ============

function renderCards() {
  const container = document.getElementById('cardsView');
  
  if (filteredCamps.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <h3>No camps match your filters</h3>
        <p>Try adjusting your search or filter criteria above</p>
      </div>
    `;
    return;
  }
  
  const start = (currentPage - 1) * RESULTS_PER_PAGE;
  const end = start + RESULTS_PER_PAGE;
  const pageCamps = filteredCamps.slice(start, end);
  
  container.innerHTML = pageCamps.map((camp, index) => {
    const globalIndex = start + index;
    const isFav = favorites.has(camp.campName);
    const isOvernight = (camp.duration || '').toLowerCase().includes('overnight') || (camp.duration || '').toLowerCase().includes('sleepaway');
    const hasAftercare = isYes(camp.aftercareAvailable);
    const hasScholarship = isYes(camp.scholarshipsOffered);
    const hasCIT = isYes(camp.citProgram);
    const hasSchoolDayOff = isYes(camp.schoolDayOffCamps);
    const isVerified = isYes(camp.verified);
    const regLink = ensureUrl(camp.registrationLink);
    
    return `
      <div class="camp-card" onclick="openCampModal(${globalIndex})">
        <div class="card-header">
          ${isVerified ? '<div class="verified-badge">‚úì Verified</div>' : ''}
          <div class="card-actions">
            <button class="card-btn ${isFav ? 'active' : ''}" onclick="toggleFavorite(event, '${escapeHtml(camp.campName)}')" title="Add to favorites">
              ${isFav ? '‚òÖ' : '‚òÜ'}
            </button>
          </div>
          <div class="card-title">${escapeHtml(camp.campName)}</div>
          <div class="card-location">${escapeHtml(camp.location)}</div>
        </div>
        <div class="card-body">
          ${camp.campDescription ? `<div class="camp-description">${escapeHtml(camp.campDescription)}</div>` : ''}
          
          <div class="info-grid">
            <div class="info-item">
              <strong>Ages</strong>
              ${camp.ageMin || '?'}-${camp.ageMax || '?'}
            </div>
            <div class="info-item">
              <strong>Dates</strong>
              ${formatDateRange(camp.startDate2026, camp.endDate2026)}
            </div>
            <div class="info-item">
              <strong>Cost</strong>
              ${escapeHtml(camp.costRange || 'Contact')}
            </div>
            <div class="info-item">
              <strong>Hours</strong>
              ${camp.startTime && camp.endTime ? `${camp.startTime}-${camp.endTime}` : 'TBD'}
            </div>
          </div>
          
          <div class="tags">
            <span class="tag ${isOvernight ? 'overnight' : 'day'}">${isOvernight ? 'Overnight' : 'Day Camp'}</span>
            ${hasAftercare ? '<span class="tag aftercare">Aftercare</span>' : ''}
            ${hasScholarship ? '<span class="tag scholarship">Scholarships</span>' : ''}
            ${hasCIT ? '<span class="tag cit">CIT</span>' : ''}
            ${hasSchoolDayOff ? '<span class="tag school-day">School Day Off</span>' : ''}
          </div>
        </div>
        <div class="card-footer">
          ${regLink ? 
            `<a href="${regLink}" target="_blank" class="reg-link" onclick="event.stopPropagation()">Register Now ‚Üí</a>` : 
            '<span class="reg-link disabled">Registration TBD</span>'
          }
        </div>
      </div>
    `;
  }).join('');
}

function renderPagination() {
  const totalPages = Math.ceil(filteredCamps.length / RESULTS_PER_PAGE);
  const pagination = document.getElementById('pagination');
  
  if (totalPages <= 1) {
    pagination.style.display = 'none';
    return;
  }
  
  pagination.style.display = 'flex';
  document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
  document.getElementById('prevPage').disabled = currentPage === 1;
  document.getElementById('nextPage').disabled = currentPage === totalPages;
}

// ============ MODAL ============

function openCampModal(index) {
  const camp = filteredCamps[index];
  const isFav = favorites.has(camp.campName);
  const isVerified = isYes(camp.verified);
  const isOvernight = (camp.duration || '').toLowerCase().includes('overnight');
  const regLink = ensureUrl(camp.registrationLink);
  
  document.getElementById('modalTitleSection').innerHTML = `
    <div class="modal-title">${escapeHtml(camp.campName)}</div>
    <div class="modal-subtitle">${escapeHtml(camp.location)} ${isVerified ? '‚Ä¢ <span style="color: var(--verified);">‚úì Verified by Camp</span>' : ''}</div>
  `;
  
  document.getElementById('modalBody').innerHTML = `
    ${camp.campDescription ? `
      <div class="detail-section">
        <h3>About This Camp</h3>
        <p style="line-height: 1.8;">${escapeHtml(camp.campDescription)}</p>
      </div>
    ` : ''}
    
    <div class="detail-section">
      <h3>Schedule & Details</h3>
      <div class="detail-grid">
        <div class="detail-label">Dates</div>
        <div class="detail-value">${camp.startDate2026 || 'TBD'} to ${camp.endDate2026 || 'TBD'}</div>
        
        <div class="detail-label">Hours</div>
        <div class="detail-value">${camp.startTime && camp.endTime ? `${camp.startTime} - ${camp.endTime}` : 'TBD'}</div>
        
        <div class="detail-label">Ages</div>
        <div class="detail-value">${camp.ageMin || '?'}-${camp.ageMax || '?'} years old</div>
        
        <div class="detail-label">Cost</div>
        <div class="detail-value">${escapeHtml(camp.costRange || 'Contact for pricing')}</div>
        
        <div class="detail-label">Duration</div>
        <div class="detail-value">${camp.duration || 'Not specified'}</div>
        
        <div class="detail-label">Setting</div>
        <div class="detail-value">${camp.indoorOutdoor || 'Not specified'}</div>
        
        ${camp.enrollmentOpenDate ? `
          <div class="detail-label">Registration Opens</div>
          <div class="detail-value">${camp.enrollmentOpenDate}</div>
        ` : ''}
      </div>
    </div>
    
    <div class="detail-section">
      <h3>Features</h3>
      <div class="tags" style="gap: 8px;">
        <span class="tag ${isYes(camp.aftercareAvailable) ? 'aftercare' : ''}" style="${!isYes(camp.aftercareAvailable) ? 'opacity: 0.4;' : ''}">
          ${isYes(camp.aftercareAvailable) ? '‚úì' : '‚úó'} Aftercare
        </span>
        <span class="tag ${isYes(camp.scholarshipsOffered) ? 'scholarship' : ''}" style="${!isYes(camp.scholarshipsOffered) ? 'opacity: 0.4;' : ''}">
          ${isYes(camp.scholarshipsOffered) ? '‚úì' : '‚úó'} Scholarships
        </span>
        <span class="tag ${isYes(camp.citProgram) ? 'cit' : ''}" style="${!isYes(camp.citProgram) ? 'opacity: 0.4;' : ''}">
          ${isYes(camp.citProgram) ? '‚úì' : '‚úó'} CIT Program
        </span>
        <span class="tag ${isYes(camp.schoolDayOffCamps) ? 'school-day' : ''}" style="${!isYes(camp.schoolDayOffCamps) ? 'opacity: 0.4;' : ''}">
          ${isYes(camp.schoolDayOffCamps) ? '‚úì' : '‚úó'} School Day Off
        </span>
      </div>
    </div>
    
    <div class="modal-actions">
      <button class="btn ${isFav ? 'btn-secondary' : 'btn-primary'}" onclick="toggleFavorite(event, '${escapeHtml(camp.campName)}'); openCampModal(${index});">
        ${isFav ? '‚òÖ Remove from Favorites' : '‚òÜ Add to Favorites'}
      </button>
      ${regLink ? 
        `<a href="${regLink}" target="_blank" class="btn btn-primary" style="text-decoration: none;">Register Now ‚Üí</a>` : 
        '<button class="btn" disabled>Registration Coming Soon</button>'
      }
    </div>
  `;
  
  document.getElementById('campModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeCampModal() {
  document.getElementById('campModal').classList.remove('active');
  document.body.style.overflow = '';
}

// ============ FAVORITES ============

function toggleFavorite(event, campName) {
  event.stopPropagation();
  
  if (favorites.has(campName)) {
    favorites.delete(campName);
  } else {
    favorites.add(campName);
  }
  
  localStorage.setItem('campFavorites', JSON.stringify([...favorites]));
  document.getElementById('favCount').textContent = favorites.size;
  document.getElementById('favBtnCount').textContent = favorites.size;
  
  renderCards();
}

function toggleFavoritesView() {
  filters.favoritesOnly = !filters.favoritesOnly;
  isInitialLoad = false;
  const btn = document.getElementById('showFavorites');
  btn.classList.toggle('btn-primary', filters.favoritesOnly);
  btn.classList.toggle('btn-secondary', !filters.favoritesOnly);
  applyFilters();
}

// ============ CLEAR FILTERS ============

function clearAllFilters() {
  filters = {
    search: '',
    location: '',
    weeks: new Set(),
    duration: new Set(),
    setting: new Set(),
    features: new Set(),
    ageMin: null,
    ageMax: null,
    favoritesOnly: false
  };
  
  document.getElementById('searchInput').value = '';
  document.getElementById('locationInput').value = '';
  document.getElementById('ageMin').value = '';
  document.getElementById('ageMax').value = '';
  document.querySelectorAll('.pill.active, .week-pill.active').forEach(el => el.classList.remove('active'));
  document.getElementById('showFavorites').classList.remove('btn-primary');
  document.getElementById('showFavorites').classList.add('btn-secondary');
  
  isInitialLoad = true;
  applyFilters();
}

// ============ SHARE ============

function closeShareModal() {
  document.getElementById('shareModal').classList.remove('active');
}

function copyShareLink() {
  const url = window.location.href.split('?')[0];
  navigator.clipboard.writeText(url);
  showShareMessage('Link copied to clipboard!');
}

function emailList() {
  const subject = encodeURIComponent('Colorado Summer Camp Options');
  const body = encodeURIComponent(`Found ${filteredCamps.length} camps!\n\n${filteredCamps.slice(0, 10).map(c => `‚Ä¢ ${c.campName} - ${c.location}`).join('\n')}\n\nView all: ${window.location.href}`);
  window.location.href = `mailto:?subject=${subject}&body=${body}`;
  showShareMessage('Opening email...');
}

function showShareMessage(msg) {
  const el = document.getElementById('shareMessage');
  el.textContent = msg;
  el.style.display = 'block';
  setTimeout(() => el.style.display = 'none', 3000);
}

// ============ INIT ============
document.getElementById('favCount').textContent = favorites.size;
document.getElementById('favBtnCount').textContent = favorites.size;
loadCamps();

// Close modals on escape
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeCampModal();
    closeShareModal();
  }
});

// Close modals on background click
document.querySelectorAll('.modal').forEach(modal => {
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      closeCampModal();
      closeShareModal();
    }
  });
});
</script>

</body>
</html>
